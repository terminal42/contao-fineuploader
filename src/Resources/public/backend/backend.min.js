!function(e,t){"function"==typeof define&&define.amd?define([],t(e)):"object"==typeof exports?module.exports=t(e):e.ContaoFineUploaderBackend=t(e)}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";function t(e,t,o){this.container=e,this.config=t,o=o||{},this.settings=JSON.parse(JSON.stringify(i));for(var a in o)o.hasOwnProperty(a)&&(this.settings[a]=o[a]);this.initUploader(),this.makeSortable()}var i={ajaxActionName:"fineuploader_reload"};return t.prototype={initUploader:function(){this.config.configCallback=this.configCallback.bind(this),this.uploader=new ContaoFineUploader(this.container,this.config),this.uploader.initFineUploader()},configCallback:function(e){e.callbacks.onUpload=this.onUploadCallback,e.callbacks.onComplete=this.onCompleteCallback.bind(this)},makeSortable:function(){var e=this.uploader.ajaxContainer.querySelector(".sortable");if(null!==e){var t,i=new Sortables(e,{contstrain:!0,opacity:.6}).addEvent("complete",function(){var i=[],o=e.getChildren("li");for(t=0;t<o.length;t++)i.push(o[t].get("data-item-id"));this.uploader.field.value=i.join(",")}.bind(this));i.fireEvent("complete")}},onUploadCallback:function(){AjaxRequest.displayBox(Contao.lang.loading+" â€¦")},onCompleteCallback:function(e,t,i){return i.success?(this.uploader.onComplete.apply(this.uploader,arguments),void(this.uploader.fineUploader.getInProgress()>0||new Request.Contao({field:this.uploader.field.name,evalScripts:!1,onSuccess:function(e,t){this.uploader.setAjaxContainerContent(t.content),t.javascript&&Browser.exec(t.javascript),AjaxRequest.hideBox(),window.fireEvent("ajax_change"),this.makeSortable()}.bind(this)}).post({action:this.settings.ajaxActionName,name:this.uploader.field.name,value:this.uploader.currentValue,REQUEST_TOKEN:this.uploader.field.form.querySelector('input[name="REQUEST_TOKEN"]').value}))):void AjaxRequest.hideBox()}},t});